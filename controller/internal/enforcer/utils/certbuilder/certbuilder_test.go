package certbuilder

import (
	"testing"
	"time"

	. "github.com/smartystreets/goconvey/convey"
)

var rootCert = `-----BEGIN CERTIFICATE-----
MIIFpDCCA4ygAwIBAgIJAJ1it4RiRTiPMA0GCSqGSIb3DQEBCwUAMF8xCzAJBgNV
BAYTAlVTMQwwCgYDVQQIDANDQUwxETAPBgNVBAoMCEFiaGkgTHRkMRQwEgYDVQQL
DAtBYmhpIEx0ZCBDQTEZMBcGA1UEAwwQQWJoaSBMdGQgUm9vdCBDQTAeFw0yMDAx
MTYyMTI1NDdaFw00MDAxMTEyMTI1NDdaMF8xCzAJBgNVBAYTAlVTMQwwCgYDVQQI
DANDQUwxETAPBgNVBAoMCEFiaGkgTHRkMRQwEgYDVQQLDAtBYmhpIEx0ZCBDQTEZ
MBcGA1UEAwwQQWJoaSBMdGQgUm9vdCBDQTCCAiIwDQYJKoZIhvcNAQEBBQADggIP
ADCCAgoCggIBAN9yYxvnkCgNVaoSajyPatsTcHKwUW8l7JRqwbBjI82JnM2EgrTZ
De8BBGbQG69qMr6at10ggYf7QgXznmE/dRK5fLREi4RAKcPBpPfgXg/dLf8t3tIF
JC/adjk9+rum8M1NuW/FuxBoq42SmJgLMOhsvPtEr6CZ2+vBQV50607ufpuxhkCT
1g/O45yPSTvfVyECsxiv//rvH2nk4mO172sVv24mlUUtc4Y0wnaBOYwEGeFyiz+C
uFEEQIMWThhNs72YU9bTVZHM4Bm9jREBslYW3UotZnZC8Fl86Uf+PXeXclpSVN8l
OjfnaaiGyGmCDtMTDQp/Vk4kFPmpkIJh9wj4J5DXKior8BjiRmsfeYDHk1c+HS1r
ho3VVQAUp+uYBRkfJXd/jB7j389sw+PQYL/RHijDui34pozSuN5Ei1VxnVHEWox0
ALhcRryc2gF0m9i3nKrBCKn8CIW6E3oYYPfCGKc8FPsyLuvlrMSnqu9ZF0H7X8kM
Cj1b1Ptw9KXVFiEbpuwLcC779g63lrMBhYTwvU9l58WAkdahwY9C8hN2uJEBeCiu
li/EskubiHTSOqUGgYX4TIFSpA3PCXFq/aUbogErfvL4evugpKqp/E4F1HHhyfY3
GTBVt4TrBy5EyIvgO1OPUQCWABck09YiJVIBnNSm6JDDVFEgb/Vi+QJDAgMBAAGj
YzBhMB0GA1UdDgQWBBQnQvC/74tEfXQoHClHi9RL+giQNjAfBgNVHSMEGDAWgBQn
QvC/74tEfXQoHClHi9RL+giQNjAPBgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQE
AwIBhjANBgkqhkiG9w0BAQsFAAOCAgEA2spfBXcFKuQT8tBChYV260Aqq+wusXpV
XR8dlNpe9qPYe946/GSTVC+/7NDHGlrjs4TpElatPsdq82t6xhOuSTJNNOwjuLiN
yB/HmUrqrlhUtJYXeSFseBOqZHgB1kwrpVT7qFtjwUnOH7Xm1IgRVElVUMeS48wH
Y8LgiDHNimuSdPDKkgXREaZvqlUBhnHhKgBtKGMpHnCqsDoV5t8z34KW2Y+Z7eYr
CKc53YrKQTwAjzdU16tyhib07IRa2mLxXQ0N1hPUsAgHDlYEqz09dEMPWSokbnbK
UsH5yjn8j1fGTwZ4dp5yGCgHHI8wkrDDEx8XcPfBiTRW6xGdlLB5OFM0r7L/zGrB
8/qGGA6QFEDg4jsqNeKj/Loj2LAJpFXlVQOnV5+yHJ8Jnn7F83W4kQnQqwclD6fF
NnbvJIHYFoZMXqtRZRbteoijvacT/lNnaYjdce32Gp4PS1ycjhSdyGY6CS60zykY
xTl5WssUFl74FcMXv31bq8dKc7P0K9lIaRZ5hWZGeIrCusgR1F41NcjMeWimHHUD
V1Z0EkDDnVprwiITEWb6+foEyPTUBIWropxYyQtGQdO722pICl0S/iefQnINJvmP
1IgGCxwprV5xQ4nJGVr5KjU2ETPmq8MZn6+QLoI8eCwIQk3o15j8vrIqSCJt1cS+
xvHfxMdUaT4=
-----END CERTIFICATE-----
`

var intermediateCert = `-----BEGIN CERTIFICATE-----
MIIFqDCCA5CgAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwXzELMAkGA1UEBhMCVVMx
DDAKBgNVBAgMA0NBTDERMA8GA1UECgwIQWJoaSBMdGQxFDASBgNVBAsMC0FiaGkg
THRkIENBMRkwFwYDVQQDDBBBYmhpIEx0ZCBSb290IENBMB4XDTIwMDEyMjE5MjQz
NFoXDTMwMDExOTE5MjQzNFowZzELMAkGA1UEBhMCVVMxDDAKBgNVBAgMA0NBTDER
MA8GA1UECgwIQWJoaSBMdGQxFDASBgNVBAsMC0FiaGkgTHRkIENBMSEwHwYDVQQD
DBhBYmhpIEx0ZCBJbnRlcm1lZGlhdGUgQ0EwggIiMA0GCSqGSIb3DQEBAQUAA4IC
DwAwggIKAoICAQCT73d8aTFNGBqTbwQvNpyCkEvRVgOGWCdA8SfjsemGvZjHb4+d
I1haNuVOgBMpt/tEVDQ7aKhsHrcUMiJpiSJlBWezi9lHsyTKcDvlxzHq9FKrW3XD
Gf2JZXtL+E1ow1z+ykvSUTVoSHiVZZvtqd2oV1t4NTFih5izh6aXqlLXwFW2dpPb
IexSRmB9Zz9ircTYqxKSmu5GzsV0W3eLn4DlKi73VVMsJWFUhPCiIcy5NQiT7Dv2
I7/X8CxX47mBdew979eIfJ/7BRszraZFGz9hUzZaIPra+N0i15gDpQaPzQS7xAfq
LtXvDUTgTqsaonzSo3mG21jaGfeLhNSCnzA5Cqjj/2ZfsMNIf7XaR8xAKgFxwZEe
PvqJ+EcOUMOORsO+wSTnGi3AglvYc47vXeWrHsD0epp8VLGswqZca0/HO6bELtBm
NDKa1Kbju6Yx6EmdqOpPKnZR3ZqSWgct9IvHf3lMqfsOYntsxEkJcngXvpYmskt5
rchBdpsGzEYMetgaQg5WIq+erF97B28q4HiJal5b70Zd0vZsGlEW/alQWayLIYev
kWcht9412mKaPSDanlroDTtLh4e8c3rn2DKeLXiM0a2iTDj7Ud+cIkZt6lfzi09s
60UcavWB4qjo7FjmF6E2wEHz8YJ9WtpiAv964BpNut/ZRGylLY0ya2cN1QIDAQAB
o2YwZDAdBgNVHQ4EFgQUHtjLfcRopnQWVjhLhJx6DpPQ9nEwHwYDVR0jBBgwFoAU
J0Lwv++LRH10KBwpR4vUS/oIkDYwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8B
Af8EBAMCAYYwDQYJKoZIhvcNAQELBQADggIBALmD+4gMOMOs4ORtC/63KOX1lZE3
vpWBFtreHp5/vuLUICW833JggLci66zH2jyARQAHDN0zVsEq0XKiati7lB/RNhJe
u8uzRw8QuT/vX0U3Hhut9xEsZNibXmFrI7cwDhv0hl5ftUiSRmovqelpEw9qkSq/
CvQeGAG+dvXHXjJmcivBqpLLyeEenPJ49rOFWFOLlD1IluFiplTInEFaF+ni1UoC
1GA5QJ/eMDShv7ffWGu0FFGtEfMjKEA6ELei0P4DnJDjrvbbeCitgSC23a/zhPyx
w8F3zdeDOSdUUoR95fV1x/Pib9O+nsrLeebK4P5f8cmep7Q0g0j/L0mzN8eUpyZX
Kip39jEiaI0X4UJWByF//QQWY1CBKWTg0601O29yTEJ39OdcFNOlKfsWdZFdY8Fj
ws/vbg9PcUuN+1zXlAEu0qFxJfj37gJ56sSH8js2xPi6fT1SrgLz+0WioyUGLj+7
8ePGe5rduyCrB0jWFj5UTLW9WtYViPrIB8UG9WIvxLSghXGs01VWzi6Mjg6iWq8Z
oaKh8onkJW2PeNtYEoHdSW5XlJb/Q1z8kVoyHM36WKG4+TtnHBp0PsMxlp0DcH2H
y3RU2jgW3K08CKv11FJFCePlDvZ7DZjA+Bgpp5sRrBKpbipuS03kLCoIMY2bdUpI
COPNRTCxu7i1pZIa
-----END CERTIFICATE-----
`

var certchain = `-----BEGIN CERTIFICATE-----
MIIFqDCCA5CgAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwXzELMAkGA1UEBhMCVVMx
DDAKBgNVBAgMA0NBTDERMA8GA1UECgwIQWJoaSBMdGQxFDASBgNVBAsMC0FiaGkg
THRkIENBMRkwFwYDVQQDDBBBYmhpIEx0ZCBSb290IENBMB4XDTIwMDEyMjE5MjQz
NFoXDTMwMDExOTE5MjQzNFowZzELMAkGA1UEBhMCVVMxDDAKBgNVBAgMA0NBTDER
MA8GA1UECgwIQWJoaSBMdGQxFDASBgNVBAsMC0FiaGkgTHRkIENBMSEwHwYDVQQD
DBhBYmhpIEx0ZCBJbnRlcm1lZGlhdGUgQ0EwggIiMA0GCSqGSIb3DQEBAQUAA4IC
DwAwggIKAoICAQCT73d8aTFNGBqTbwQvNpyCkEvRVgOGWCdA8SfjsemGvZjHb4+d
I1haNuVOgBMpt/tEVDQ7aKhsHrcUMiJpiSJlBWezi9lHsyTKcDvlxzHq9FKrW3XD
Gf2JZXtL+E1ow1z+ykvSUTVoSHiVZZvtqd2oV1t4NTFih5izh6aXqlLXwFW2dpPb
IexSRmB9Zz9ircTYqxKSmu5GzsV0W3eLn4DlKi73VVMsJWFUhPCiIcy5NQiT7Dv2
I7/X8CxX47mBdew979eIfJ/7BRszraZFGz9hUzZaIPra+N0i15gDpQaPzQS7xAfq
LtXvDUTgTqsaonzSo3mG21jaGfeLhNSCnzA5Cqjj/2ZfsMNIf7XaR8xAKgFxwZEe
PvqJ+EcOUMOORsO+wSTnGi3AglvYc47vXeWrHsD0epp8VLGswqZca0/HO6bELtBm
NDKa1Kbju6Yx6EmdqOpPKnZR3ZqSWgct9IvHf3lMqfsOYntsxEkJcngXvpYmskt5
rchBdpsGzEYMetgaQg5WIq+erF97B28q4HiJal5b70Zd0vZsGlEW/alQWayLIYev
kWcht9412mKaPSDanlroDTtLh4e8c3rn2DKeLXiM0a2iTDj7Ud+cIkZt6lfzi09s
60UcavWB4qjo7FjmF6E2wEHz8YJ9WtpiAv964BpNut/ZRGylLY0ya2cN1QIDAQAB
o2YwZDAdBgNVHQ4EFgQUHtjLfcRopnQWVjhLhJx6DpPQ9nEwHwYDVR0jBBgwFoAU
J0Lwv++LRH10KBwpR4vUS/oIkDYwEgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8B
Af8EBAMCAYYwDQYJKoZIhvcNAQELBQADggIBALmD+4gMOMOs4ORtC/63KOX1lZE3
vpWBFtreHp5/vuLUICW833JggLci66zH2jyARQAHDN0zVsEq0XKiati7lB/RNhJe
u8uzRw8QuT/vX0U3Hhut9xEsZNibXmFrI7cwDhv0hl5ftUiSRmovqelpEw9qkSq/
CvQeGAG+dvXHXjJmcivBqpLLyeEenPJ49rOFWFOLlD1IluFiplTInEFaF+ni1UoC
1GA5QJ/eMDShv7ffWGu0FFGtEfMjKEA6ELei0P4DnJDjrvbbeCitgSC23a/zhPyx
w8F3zdeDOSdUUoR95fV1x/Pib9O+nsrLeebK4P5f8cmep7Q0g0j/L0mzN8eUpyZX
Kip39jEiaI0X4UJWByF//QQWY1CBKWTg0601O29yTEJ39OdcFNOlKfsWdZFdY8Fj
ws/vbg9PcUuN+1zXlAEu0qFxJfj37gJ56sSH8js2xPi6fT1SrgLz+0WioyUGLj+7
8ePGe5rduyCrB0jWFj5UTLW9WtYViPrIB8UG9WIvxLSghXGs01VWzi6Mjg6iWq8Z
oaKh8onkJW2PeNtYEoHdSW5XlJb/Q1z8kVoyHM36WKG4+TtnHBp0PsMxlp0DcH2H
y3RU2jgW3K08CKv11FJFCePlDvZ7DZjA+Bgpp5sRrBKpbipuS03kLCoIMY2bdUpI
COPNRTCxu7i1pZIa
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIFpDCCA4ygAwIBAgIJAJ1it4RiRTiPMA0GCSqGSIb3DQEBCwUAMF8xCzAJBgNV
BAYTAlVTMQwwCgYDVQQIDANDQUwxETAPBgNVBAoMCEFiaGkgTHRkMRQwEgYDVQQL
DAtBYmhpIEx0ZCBDQTEZMBcGA1UEAwwQQWJoaSBMdGQgUm9vdCBDQTAeFw0yMDAx
MTYyMTI1NDdaFw00MDAxMTEyMTI1NDdaMF8xCzAJBgNVBAYTAlVTMQwwCgYDVQQI
DANDQUwxETAPBgNVBAoMCEFiaGkgTHRkMRQwEgYDVQQLDAtBYmhpIEx0ZCBDQTEZ
MBcGA1UEAwwQQWJoaSBMdGQgUm9vdCBDQTCCAiIwDQYJKoZIhvcNAQEBBQADggIP
ADCCAgoCggIBAN9yYxvnkCgNVaoSajyPatsTcHKwUW8l7JRqwbBjI82JnM2EgrTZ
De8BBGbQG69qMr6at10ggYf7QgXznmE/dRK5fLREi4RAKcPBpPfgXg/dLf8t3tIF
JC/adjk9+rum8M1NuW/FuxBoq42SmJgLMOhsvPtEr6CZ2+vBQV50607ufpuxhkCT
1g/O45yPSTvfVyECsxiv//rvH2nk4mO172sVv24mlUUtc4Y0wnaBOYwEGeFyiz+C
uFEEQIMWThhNs72YU9bTVZHM4Bm9jREBslYW3UotZnZC8Fl86Uf+PXeXclpSVN8l
OjfnaaiGyGmCDtMTDQp/Vk4kFPmpkIJh9wj4J5DXKior8BjiRmsfeYDHk1c+HS1r
ho3VVQAUp+uYBRkfJXd/jB7j389sw+PQYL/RHijDui34pozSuN5Ei1VxnVHEWox0
ALhcRryc2gF0m9i3nKrBCKn8CIW6E3oYYPfCGKc8FPsyLuvlrMSnqu9ZF0H7X8kM
Cj1b1Ptw9KXVFiEbpuwLcC779g63lrMBhYTwvU9l58WAkdahwY9C8hN2uJEBeCiu
li/EskubiHTSOqUGgYX4TIFSpA3PCXFq/aUbogErfvL4evugpKqp/E4F1HHhyfY3
GTBVt4TrBy5EyIvgO1OPUQCWABck09YiJVIBnNSm6JDDVFEgb/Vi+QJDAgMBAAGj
YzBhMB0GA1UdDgQWBBQnQvC/74tEfXQoHClHi9RL+giQNjAfBgNVHSMEGDAWgBQn
QvC/74tEfXQoHClHi9RL+giQNjAPBgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQE
AwIBhjANBgkqhkiG9w0BAQsFAAOCAgEA2spfBXcFKuQT8tBChYV260Aqq+wusXpV
XR8dlNpe9qPYe946/GSTVC+/7NDHGlrjs4TpElatPsdq82t6xhOuSTJNNOwjuLiN
yB/HmUrqrlhUtJYXeSFseBOqZHgB1kwrpVT7qFtjwUnOH7Xm1IgRVElVUMeS48wH
Y8LgiDHNimuSdPDKkgXREaZvqlUBhnHhKgBtKGMpHnCqsDoV5t8z34KW2Y+Z7eYr
CKc53YrKQTwAjzdU16tyhib07IRa2mLxXQ0N1hPUsAgHDlYEqz09dEMPWSokbnbK
UsH5yjn8j1fGTwZ4dp5yGCgHHI8wkrDDEx8XcPfBiTRW6xGdlLB5OFM0r7L/zGrB
8/qGGA6QFEDg4jsqNeKj/Loj2LAJpFXlVQOnV5+yHJ8Jnn7F83W4kQnQqwclD6fF
NnbvJIHYFoZMXqtRZRbteoijvacT/lNnaYjdce32Gp4PS1ycjhSdyGY6CS60zykY
xTl5WssUFl74FcMXv31bq8dKc7P0K9lIaRZ5hWZGeIrCusgR1F41NcjMeWimHHUD
V1Z0EkDDnVprwiITEWb6+foEyPTUBIWropxYyQtGQdO722pICl0S/iefQnINJvmP
1IgGCxwprV5xQ4nJGVr5KjU2ETPmq8MZn6+QLoI8eCwIQk3o15j8vrIqSCJt1cS+
xvHfxMdUaT4=
-----END CERTIFICATE-----
`

var clientCert = `-----BEGIN CERTIFICATE-----
MIIFdjCCA16gAwIBAgICEAEwDQYJKoZIhvcNAQELBQAwZzELMAkGA1UEBhMCVVMx
DDAKBgNVBAgMA0NBTDERMA8GA1UECgwIQWJoaSBMdGQxFDASBgNVBAsMC0FiaGkg
THRkIENBMSEwHwYDVQQDDBhBYmhpIEx0ZCBJbnRlcm1lZGlhdGUgQ0EwHhcNMjAw
MTIyMjE1MjIzWhcNMjEwMTMxMjE1MjIzWjBqMQswCQYDVQQGEwJVUzEMMAoGA1UE
CAwDQ0FMMQ8wDQYDVQQHDAZjbGllbnQxETAPBgNVBAoMCEFiaGkgTHRkMRgwFgYD
VQQLDA9BYmhpIEx0ZCBjbGllbnQxDzANBgNVBAMMBmNsaWVudDCCASIwDQYJKoZI
hvcNAQEBBQADggEPADCCAQoCggEBAKFb+Gqq4UVgwzcbLuXs1o0vAIQyOO4aepS3
+eg960thYiYVLkinag95tm0h1fNuBxFDQaiTsibDokVXS3uKqeMRnyAzRXyHti4r
gosII9yYH4OujnjG/W4fFIu6zBMiBo9IQlKioWNn/wcQ9OOvF4cth5IoHweH5Vlt
OwZ5Ri53dYsdHT23aH23tPrKhRuQXjPjXYTf3y1TgQ3dSMgNPMqZMSXBqjDp7xEu
NX/7QloERLQiJ38kUgMfo9bPSMjLeXP48GneVi1HGy/a5nXHjda4Vp4jupZmgyNI
QfXzDSOmDB25QEkhzgmUo260oMRo26B4CMANf2fmI+JtEqzJBpkCAwEAAaOCAScw
ggEjMAkGA1UdEwQCMAAwEQYJYIZIAYb4QgEBBAQDAgZAMDMGCWCGSAGG+EIBDQQm
FiRPcGVuU1NMIEdlbmVyYXRlZCBTZXJ2ZXIgQ2VydGlmaWNhdGUwHQYDVR0OBBYE
FE1IFk6guty8o4K/8s64Ev95Ij3MMIGJBgNVHSMEgYEwf4AUHtjLfcRopnQWVjhL
hJx6DpPQ9nGhY6RhMF8xCzAJBgNVBAYTAlVTMQwwCgYDVQQIDANDQUwxETAPBgNV
BAoMCEFiaGkgTHRkMRQwEgYDVQQLDAtBYmhpIEx0ZCBDQTEZMBcGA1UEAwwQQWJo
aSBMdGQgUm9vdCBDQYICEAAwDgYDVR0PAQH/BAQDAgWgMBMGA1UdJQQMMAoGCCsG
AQUFBwMBMA0GCSqGSIb3DQEBCwUAA4ICAQArTprbjprNaoVmvDJqfhJ+oR9oO9DN
OGXeOk4JuXYvCF7OWOnMWPDoSok/PlAW+0CsDFN0s7cJDbXy1vX3OFqLKR+VzbEK
b8tDVggdq4eABWx3+KWsfLi9msznKiKn2xDrCENkWtE8S2b3mxvcLUFY2m2dkyQZ
JNS3p0EsZ/Grky0LzbYCOZwzTzezjNXQIKxYT993yM5ZfPFSi3d0a+fi2I9QCVl4
Rbs47+UPir1WDyje3I0w+YxBlJdGs3u9Zi3BM1lUFHIRqSXQcfwWHq85jA5QlcHg
SWeigx6fhcGNVE8I9j0fKvwABTjy4HN3mNQlZnujAdxYJX9jzWGpXnAd+L5LIJXY
yFoMGgJTBjQ3minsf9PYJfhSmvtMU9V5ZbwahuWhwn4S9fz2prkUKD373+H1KOGd
SXg1/4apPKZRkRDm14m3OMFS+AI5dv8k/UtJEWv3ZK0VCQRCh4yb3IxKBn2kL5Uf
T+vthr0xpgwBPIhUI3mylooWYj59qpioS8eQHWuqy9cNgQGg2wiuEcEshEdxMuSU
eQODZFiG9VwsmSNEDlaMSdRGQbJw84UFaQ2LWjgz1cep0Sgwdpzt8pPnPq/7j39e
fF2UXoxF1g6VLdOcQEJXKwfP5kCGqW4j6nVFNHYAj3UAoIhHMQppr9lAFdHdyc57
mipZrK3sH+ROJw==
-----END CERTIFICATE-----
`

var serverCert = `  
----BEGIN CERTIFICATE-----
MIIFiDCCA3CgAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwZzELMAkGA1UEBhMCVVMx
DDAKBgNVBAgMA0NBTDERMA8GA1UECgwIQWJoaSBMdGQxFDASBgNVBAsMC0FiaGkg
THRkIENBMSEwHwYDVQQDDBhBYmhpIEx0ZCBJbnRlcm1lZGlhdGUgQ0EwHhcNMjAw
MTIyMjEyMzQwWhcNMjEwMTMxMjEyMzQwWjB8MQswCQYDVQQGEwJVUzEMMAoGA1UE
CAwDQ0FMMRQwEgYDVQQHDAtTYW50YSBDbGFyYTERMA8GA1UECgwIQWJoaSBMdGQx
HDAaBgNVBAsME0FiaGkgTHRkIHdlYiBzZXJ2ZXIxGDAWBgNVBAMMD3d3dy5lbnZv
eXV0LmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKFb+Gqq4UVg
wzcbLuXs1o0vAIQyOO4aepS3+eg960thYiYVLkinag95tm0h1fNuBxFDQaiTsibD
okVXS3uKqeMRnyAzRXyHti4rgosII9yYH4OujnjG/W4fFIu6zBMiBo9IQlKioWNn
/wcQ9OOvF4cth5IoHweH5VltOwZ5Ri53dYsdHT23aH23tPrKhRuQXjPjXYTf3y1T
gQ3dSMgNPMqZMSXBqjDp7xEuNX/7QloERLQiJ38kUgMfo9bPSMjLeXP48GneVi1H
Gy/a5nXHjda4Vp4jupZmgyNIQfXzDSOmDB25QEkhzgmUo260oMRo26B4CMANf2fm
I+JtEqzJBpkCAwEAAaOCAScwggEjMAkGA1UdEwQCMAAwEQYJYIZIAYb4QgEBBAQD
AgZAMDMGCWCGSAGG+EIBDQQmFiRPcGVuU1NMIEdlbmVyYXRlZCBTZXJ2ZXIgQ2Vy
dGlmaWNhdGUwHQYDVR0OBBYEFE1IFk6guty8o4K/8s64Ev95Ij3MMIGJBgNVHSME
gYEwf4AUHtjLfcRopnQWVjhLhJx6DpPQ9nGhY6RhMF8xCzAJBgNVBAYTAlVTMQww
CgYDVQQIDANDQUwxETAPBgNVBAoMCEFiaGkgTHRkMRQwEgYDVQQLDAtBYmhpIEx0
ZCBDQTEZMBcGA1UEAwwQQWJoaSBMdGQgUm9vdCBDQYICEAAwDgYDVR0PAQH/BAQD
AgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBCwUAA4ICAQApBQBx
lG+RU8/BzE5mMH4SiWQPKOjb8OLyEy/62p87+PjO9Gmasdmwk3iBuAiSpmP/srtq
M3SL9CoOSvd743sImlgxzIfyY6MR7bIxZPKaokbio6eYpDLhxp/gNCZZhclo7d3C
gwiBtJrv9a3UdZLhCT1kbGN+ZmaTD8UXrxVz741/WxqyDE64w4M5sbSxehq4NmaI
dsZPPPx0cvo029yS34tSa0drFln/blPdmDiJc3cmtZNc3uShW5PJyyjZBfwZbs6x
SGfN6tSr+g+T94a67IdADUNkQ0+Wn0k8ckhV9izdLHKKarL4AdhrMpKt+DE8Ry4t
BTLd3M64b7kBQYyXL4sg/D0RixiJ2R0EINp2e0CLc0qvCClWstfQwZepSC/FTC02
ELjKxoUlKYF91yAzPAa7m0geGLtUM3u8r5uGCBLj1Gdcm8UwjLKofvU0KQyJYg4a
fXNYlHtwN41FZT2BkBTdZsCOFqpCw4vFHGB+cBWWiCkajp9tcbwtI1CDEE9Ximxi
hf+Dxf8vNYZMxnLKgJtUB/mQ2r5+pKs+SlCHiNmwVKY0eslKiQqGteCvdxixiwYC
2L+Drxh7OhDp4UB4wG0mU1RGFA/HKc+yGAqNz1k542l7kKvZ/q0pmRan6aVnjxRC
eE2tOelSbSG5ZmxcCwpEJrgk20ed+TuVVriVtA==
-----END CERTIFICATE-----
`

func Test_GetExpTimeFromCert(t *testing.T) {
	Convey("Test the expire time of the certs", t, func() {
		expTime, err := GetExpTimeFromCert([]byte(intermediateCert))
		tmp := time.Date(
			2030, 01, 19, 19, 24, 34, 0, time.UTC)

		So(err, ShouldBeNil)
		So(tmp, ShouldEqual, expTime)
	})
}

func Test_WrongGetExpTimeFromCert(t *testing.T) {
	Convey("Test the expire time of the wrong certs", t, func() {
		_, err := GetExpTimeFromCert([]byte(serverCert))

		So(err, ShouldNotBeNil)

	})
}

func Test_GetRootCert(t *testing.T) {
	Convey("Test the getRoot certificate", t, func() {
		CertByte, err := GetTopRootCa([]byte(certchain))

		So(err, ShouldBeNil)
		So(string(CertByte), ShouldEqual, rootCert)
	})
}

// func Test_X509CertChainToPem

// func Test_X509CertToPem

func Test_BuildCertChain(t *testing.T) {
	Convey("Test the buildCertChain", t, func() {
		CertByte, err := BuildCertChain([]byte(intermediateCert), []byte(rootCert))
		So(err, ShouldBeNil)
		So(string(CertByte), ShouldEqual, certchain)
	})
}

// func Test_BuildWrongCertChain(t *testing.T) {
// 	Convey("Test the buildCertChain", t, func() {
// 		CertByte, err := BuildCertChain([]byte(intermediateCert), []byte(serverCert))
// 		fmt.Println("\n\n *** ", err, CertByte)
// 		if err != nil {
// 			fmt.Println("*****")
// 		} else {
// 			So(err, ShouldNotBeNil)

// 		}
// 	})
// }
